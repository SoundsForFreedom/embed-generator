<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Player - Simulated Waveform</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet" />
    <style>
        :root {
            --primary: #f97316;
            /* Orange-500 */
            --bg-bar: #e5e7eb;
            /* Gray-200 */
            --bg-active: #f97316;
            --text-main: #334155;
            --bg-page: #f8fafc;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background: var(--bg-page);
            margin: 0;
            padding: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .player-bar {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: white;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05);
            padding: 15px 20px;
            display: flex;
            justify-content: center;
            border-top: 1px solid #f1f5f9;
        }

        .player-content {
            width: 100%;
            max-width: 1000px;
            display: flex;
            align-items: center;
            gap: 20px;
            justify-content: space-between;
        }

        .play-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(249, 115, 22, 0.3);
            transition: transform 0.2s;
            flex-shrink: 0;
        }

        .play-btn:hover {
            transform: scale(1.05);
            background: #ea580c;
        }

        .track-info {
            display: flex;
            flex-direction: column;
            min-width: 150px;
        }

        .track-title {
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--text-main);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }

        .track-status {
            font-size: 1.4rem;
            color: #94a3b8;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Waveform Bars Container */
        .wave-container {
            flex: 1;
            height: 40px;
            display: flex;
            align-items: center;
            gap: 3px;
            position: relative;
            cursor: pointer;
            /* Mask overflow implies we need to handle clicks delicately */
        }

        .bar {
            width: 6px;
            background: var(--bg-bar);
            border-radius: 4px;
            height: 40%;
            /* Initial random height set by JS */
            transition: height 0.2s, background-color 0.1s;
        }

        .bar.active {
            background: var(--bg-active);
        }

        .bar.animate {
            animation: soundWave 1.2s ease-in-out infinite;
        }

        @keyframes soundWave {

            0%,
            100% {
                height: 40%;
            }

            50% {
                height: 100%;
            }
        }

        /* Overlay Range Input */
        .seek-slider {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            /* Invisible but clickable */
            cursor: pointer;
            z-index: 10;
        }

        /* Mode Switcher */
        .mode-switch {
            display: flex;
            align-items: center;
            background: #f1f5f9;
            border-radius: 12px;
            padding: 4px;
            cursor: pointer;
        }

        .mode-btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            background: transparent;
            color: #64748b;
            font-weight: 700;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .mode-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        /* Hidden Iframes */
        .sc-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            opacity: 0;
            left: -9999px;
            overflow: hidden;
        }

        #debug-log {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #1e293b;
            color: #4ade80;
            font-family: monospace;
            font-size: 11px;
            padding: 10px;
            border-radius: 8px;
            max-width: 300px;
            z-index: 9999;
            display: none;
        }
    </style>
</head>

<body>

    <div class="player-bar">
        <div class="player-content">
            <!-- Play Button -->
            <button class="play-btn" id="playBtn">
                <span class="material-icons-round" style="font-size: 32px;">play_arrow</span>
            </button>

            <!-- Info -->
            <div class="track-info hidden sm:block">
                <div class="track-status" id="statusText">SoundCloud</div>
                <div class="track-title" id="trackTitle">Loading...</div>
            </div>

            <!-- Visualizer -->
            <div class="wave-container" id="visualizer">
                <!-- Bars generated by JS -->
                <!-- Range input overlay -->
                <input type="range" class="seek-slider" id="progressBar" min="0" max="100" value="0" step="0.1">
            </div>

            <!-- Mode Switch -->
            <div class="mode-switch" id="modeSwitch">
                <button class="mode-btn active" data-mode="vocal">
                    <span class="material-icons-round" style="font-size:18px;">mic</span>
                    Vocal
                </button>
                <button class="mode-btn" data-mode="instrumental">
                    <span class="material-icons-round" style="font-size:18px;">mic_off</span>
                    Inst
                </button>
            </div>

            <div style="font-size: 1.5rem; font-weight: 700; color: #0c0c0c; min-width: 40px; text-align: right;"
                id="timeDisplay">0:00</div>
        </div>
    </div>

    <!-- Hidden Iframes -->
    <div class="sc-hidden">
        <iframe id="sc-vocal" scrolling="no" frameborder="no" allow="autoplay"
            src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/2090424033%3Fsecret_token%3Ds-ZBvOslZbAdP&color=%23ff5500&auto_play=false&hide_related=false&show_comments=false&visual=false"></iframe>

        <iframe id="sc-inst" scrolling="no" frameborder="no" allow="autoplay"
            src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/2090424027%3Fsecret_token%3Ds-tj5JsbPPrzk&color=%23ff5500&auto_play=false&hide_related=false&show_comments=false&visual=false"></iframe>
    </div>

    <div id="debug-log">Debug:<br></div>

    <script>
        // Debug
        function log(msg) {
            console.log('[Player]', msg);
            const el = document.getElementById('debug-log');
            if (el) el.innerHTML += msg + '<br>';
        }

        // Load API
        function loadApi(cb) {
            if (window.SC) { cb(); return; }
            const s = document.createElement('script');
            s.src = 'https://w.soundcloud.com/player/api.js';
            s.onload = cb;
            document.body.appendChild(s);
        }

        // Generate Bars
        function createBars() {
            const container = document.getElementById('visualizer');
            const count = 40; // Number of bars
            let html = '';
            for (let i = 0; i < count; i++) {
                // Random height between 30% and 100%
                const h = Math.floor(Math.random() * 70) + 30;
                // Negative delay for randomness
                const d = (Math.random() * -1).toFixed(2);
                html += `<div class="bar" id="bar-${i}" style="height:${h}%; animation-delay:${d}s"></div>`;
            }
            // Insert before the input
            const input = document.getElementById('progressBar');
            const temp = document.createElement('div');
            temp.innerHTML = html;
            while (temp.firstChild) {
                container.insertBefore(temp.firstChild, input);
            }
        }

        function init() {
            createBars();
            log("Bars created");

            let activeMode = 'vocal';
            let isPlaying = false;
            let duration = 0;

            const playBtn = document.getElementById('playBtn');
            const playIcon = playBtn.querySelector('span');
            const pBar = document.getElementById('progressBar');
            const timeDisp = document.getElementById('timeDisplay');
            const titleEl = document.getElementById('trackTitle');
            const statusEl = document.getElementById('statusText');

            const modeBtns = document.querySelectorAll('.mode-btn');
            const bars = document.querySelectorAll('.bar');

            const widgetV = SC.Widget(document.getElementById('sc-vocal'));
            const widgetI = SC.Widget(document.getElementById('sc-inst'));

            function formatTime(ms) {
                if (!ms) return "0:00";
                const s = Math.floor(ms / 1000);
                const m = Math.floor(s / 60);
                const sec = s % 60;
                return `${m}:${sec < 10 ? '0' : ''}${sec}`;
            }

            function updateUI(ms) {
                if (duration > 0) {
                    pBar.value = ms;
                    timeDisp.textContent = formatTime(ms);

                    // Colorize bars
                    const percent = (ms / duration);
                    const activeIndex = Math.floor(percent * bars.length);

                    bars.forEach((bar, i) => {
                        if (i <= activeIndex) {
                            bar.classList.add('active');
                        } else {
                            bar.classList.remove('active');
                        }

                        // Animate if playing
                        if (isPlaying) {
                            bar.style.animationPlayState = 'running';
                            // Optional: Only animate up to current progress or all? 
                            // Typically all bars animate to show "music is playing".
                            // Or maybe only active ones? Let's animate ALL for vibe.
                            bar.classList.add('animate');
                        } else {
                            bar.classList.remove('animate');
                            bar.style.animationPlayState = 'paused';
                        }
                    });
                }
            }

            // Ready Handlers
            widgetV.bind(SC.Widget.Events.READY, () => {
                widgetV.getDuration(d => { duration = d; pBar.max = d; });
                widgetV.getCurrentSound(s => { if (s) titleEl.textContent = s.title; });
                log("Vocal Ready");
            });

            widgetI.bind(SC.Widget.Events.READY, () => {
                widgetI.setVolume(100);
                log("Inst Ready");
            });

            // Event Sync
            function setPlayState(playing) {
                isPlaying = playing;
                playIcon.textContent = playing ? 'pause' : 'play_arrow';
                bars.forEach(b => {
                    if (playing) b.classList.add('animate');
                    else b.classList.remove('animate');
                });
            }

            [widgetV, widgetI].forEach(w => {
                w.bind(SC.Widget.Events.PLAY, () => setPlayState(true));
                w.bind(SC.Widget.Events.PAUSE, () => setPlayState(false));
                w.bind(SC.Widget.Events.FINISH, () => { setPlayState(false); updateUI(0); });
                w.bind(SC.Widget.Events.PLAY_PROGRESS, e => {
                    const isV = (activeMode === 'vocal' && w === widgetV);
                    const isI = (activeMode === 'instrumental' && w === widgetI);
                    if (isV || isI) updateUI(e.currentPosition);
                });
            });

            // Controls
            playBtn.onclick = () => {
                const w = activeMode === 'vocal' ? widgetV : widgetI;
                w.toggle();
            };

            pBar.oninput = function () {
                // Visual update while dragging
                const ms = parseInt(this.value);
                timeDisp.textContent = formatTime(ms);
                const percent = (ms / duration);
                const activeIndex = Math.floor(percent * bars.length);
                bars.forEach((bar, i) => {
                    bar.classList.toggle('active', i <= activeIndex);
                });
            };

            pBar.onchange = function () {
                const ms = parseInt(this.value);
                const w = activeMode === 'vocal' ? widgetV : widgetI;
                w.seekTo(ms);
            };

            // Mode Switch
            modeBtns.forEach(btn => {
                btn.onclick = () => {
                    const newMode = btn.dataset.mode;
                    if (newMode === activeMode) return;

                    // Toggle UI
                    modeBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    // Switch Audio
                    if (activeMode === 'vocal') { // To Instrumental
                        widgetV.getPosition(pos => {
                            widgetV.pause();
                            widgetI.seekTo(pos);
                            widgetI.play();
                            activeMode = 'instrumental';
                            statusEl.textContent = "Instrumental";
                        });
                    } else { // To Vocal
                        widgetI.getPosition(pos => {
                            widgetI.pause();
                            widgetV.seekTo(pos);
                            widgetV.play();
                            activeMode = 'vocal';
                            statusEl.textContent = "Vocal";
                        });
                    }
                };
            });
        }

        if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', () => loadApi(init));
        else loadApi(init);
    </script>

</body>

</html>